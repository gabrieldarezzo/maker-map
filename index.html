<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordinator Generator</title>


    <style>

        html, body {
            margin :0px;
            padding :0px;
            width: 100%;
            height: 100%
        }

        #map-json {
            height: 100%;
            display: flex;
        }

        #map-json div {
            width: 100%;
            height: 100%;
        }


        #map-picpay {
            margin: 0;
            padding: 0;   
        }

        #map {
            background-color: blue;
        }

        #coordinators {
            background-color: red;
        }
    </style>

</head>
<body>

  

<section id="map-json">
    <div id="map-picpay"></div>
    <div id="coordinators"></div>
</section>

<script>

var clickedMark = [];
function initMap() {

    function setListerClickMap(mapGoogle) {

        
        google.maps.event.addListener(mapGoogle, "click", function (event) {
            const clickMapLatLng = {
                 'lat': event.latLng.lat()
                ,'lng': event.latLng.lng()
            };

            console.log('fired')

            console.log(clickMapLatLng);

            var lastMarkClicked = new google.maps.Marker({
                position: new google.maps.LatLng(event.latLng.lat(), event.latLng.lng()),
                map: mapGoogle,
                title: '',
                icon: getIconMouseOut(1), // New Pin
            });

            clickedMark.push(lastMarkClicked);
            lastMarkClicked.setVisible(true);


            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({'location': lastMarkClicked.position}, function(results, status) {
                const locationFound = results[0];
          
                results.map(customLocation => {
                    if(customLocation.place_id != null) {
                        var request = {
                            placeId: customLocation.place_id,
                            fields: ['name', 'rating', 'formatted_phone_number', 'geometry']
                            // fields: ['name']
                        };
                        
                        service = new google.maps.places.PlacesService(mapGoogle);
                        service.getDetails(request, function (place, status) {
                            if (status == google.maps.places.PlacesServiceStatus.OK) {
                                if(place.formatted_phone_number) {
                                    console.log(place);
                                }
                            }
                        });
                    }
                })
            });
        });
    }

 


    // const actualPosition = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
    const actualPosition = new google.maps.LatLng(48.19976, 16.45572);
    var picPay = new google.maps.Map(document.getElementById('map-picpay'), {
        center: actualPosition,
        zoom: 16,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        mapTypeControl: false,
    });

    
    google.maps.event.addListener(picPay, "click", function (event) {
        const clickMapLatLng = {
                'lat': event.latLng.lat()
            ,'lng': event.latLng.lng()
        };
        console.log(clickMapLatLng);
    });

    // setListerClickMap(picPay);


    /*
    var geolocationActive;
    if (!"geolocation" in navigator || !navigator.geolocation){
        alert("Browser atualizadinho em ?!");
    }

    geolocationActive = true;
    navigator.geolocation.getCurrentPosition(function(position) {

        const actualPosition = new google.maps.LatLng(48.19976, 16.45572);
        var picPay = new google.maps.Map(document.getElementById('map-picpay'), {
            center: actualPosition,
            zoom: 16,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            mapTypeControl: true,
        });

    }, function(err){
        console.log(err);
        //Error Block
        // ->Solicitando_permissÃ£o
        // https://developer.mozilla.org/pt-BR/docs/Using_geolocation
        //https://support.google.com/chrome/answer/142065?hl=enconsole.warn('ERROR(' + err.code + '): ' + err.message);
        if(err.PERMISSION_DENIED){
            alert('You need grant permission of your location and reload if you want see your position');
        }

    }, {
        enableHighAccuracy: false,
        timeout: 5000,
        maximumAge: 60000,
    } );
    */


    
}


// google.maps.event.addDomListener(window, "load", initialize);
</script>


<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.35&key=AIzaSyA-1wiOh5Uhv4dXkytXfk965N5zEiLm1L4&libraries=places&callback=initMap" async defer></script>
</body>
</html>